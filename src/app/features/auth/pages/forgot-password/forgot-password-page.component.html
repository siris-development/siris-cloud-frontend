<div class="rounded-xl shadow-lg p-12 w-full relative backdrop-blur-md">
  <div class="text-center mb-10">
    <h1 class="text-3xl font-bold mb-2 bg-clip-text text-black">
      Recuperar Contraseña
    </h1>
    <p class="text-gray-400 text-base font-normal">
      Te enviaremos un enlace para restablecer tu contraseña
    </p>
  </div>

  @if (!isEmailSent()) {
    <form [formGroup]="forgotPasswordForm" (ngSubmit)="sendResetEmail()" class="flex flex-col gap-6">
      <div class="relative">
        <label class="block mb-2 text-gray-400 text-sm font-medium" for="resetEmail">
          Correo electrónico
        </label>
        <input 
          id="resetEmail" 
          name="email" 
          formControlName="email"
          class="w-full px-4 py-3 border rounded-lg text-gray-500 text-base transition-all outline-none placeholder:text-gray-500"
          type="email" 
          placeholder="tu@email.com" 
          required 
        />

        @if (email?.invalid && (email?.dirty || email?.touched)) {
          <div class="text-red-400 text-xs mt-2">
            @if (email?.hasError('required')) {
              <div>El correo es obligatorio.</div>
            }
            @if (email?.hasError('email')) {
              <div>El correo no es válido.</div>
            }
          </div>
        }
      </div>

      <button 
        type="submit"
        class="flex items-center justify-center px-6 py-3 rounded-lg font-semibold bg-black text-white shadow-md transition disabled:opacity-60 disabled:cursor-not-allowed hover:bg-gray-800 cursor-pointer"
        [disabled]="loading()"
      >
        {{ loading() ? 'Enviando...' : 'Enviar enlace de recuperación' }}
      </button>
    </form>

    <!-- Opciones adicionales -->
    <div class="mt-6 pt-6 border-t border-gray-200">
      <p class="text-gray-500 text-sm text-center mb-4">
        ¿No recibiste el email? Prueba estas opciones:
      </p>
      
      <div class="flex flex-col gap-3">
        <button 
          type="button"
          (click)="handleMissingEmail()"
          class="px-4 py-2 text-sm text-blue-600 hover:text-blue-800 hover:underline cursor-pointer"
          [disabled]="loading()"
        >
          Reenviar email de recuperación
        </button>
        
        <button 
          type="button"
          (click)="recoverAccount()"
          class="px-4 py-2 text-sm text-green-600 hover:text-green-800 hover:underline cursor-pointer"
          [disabled]="loading()"
        >
          Recuperación inteligente de cuenta
        </button>
      </div>
    </div>
  }

  @if (isEmailSent()) {
    <div class="text-center">
      <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      
      <h2 class="text-xl font-semibold text-gray-800 mb-2">
        ¡Email enviado!
      </h2>
      
      <p class="text-gray-600 mb-6">
        Hemos enviado un enlace de recuperación a tu correo electrónico. 
        Revisa tu bandeja de entrada y sigue las instrucciones.
      </p>
      
      <div class="space-y-3">
        <button 
          type="button"
          (click)="isEmailSent.set(false)"
          class="w-full px-4 py-2 text-sm text-blue-600 hover:text-blue-800 hover:underline cursor-pointer"
        >
          Enviar a otro email
        </button>
        
        <button 
          type="button"
          [routerLink]="['/auth/login']"
          class="w-full px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:underline cursor-pointer"
        >
          Volver al inicio de sesión
        </button>
      </div>
    </div>
  }

  <div class="flex items-center justify-center mt-8 gap-2">
    <span class="text-gray-400 text-sm">¿Recordaste tu contraseña?</span>
    <button 
      type="button" 
      class="text-black hover:underline text-sm font-semibold cursor-pointer" 
      [routerLink]="['/auth/login']"
    >
      Iniciar sesión
    </button>
  </div>
</div>

@if (hasError()) {
  <div 
    role="alert"
    class="animate-fadeIn fixed bottom-5 right-5 w-80 bg-red-100 text-red-800 border border-red-300 rounded-lg p-4 shadow-md"
  >
    <div class="flex items-start">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current mr-2" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div>
        <p class="font-medium">Error</p>
        <p class="text-sm">{{ errorMessage() }}</p>
      </div>
    </div>
  </div>
}
